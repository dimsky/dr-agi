<view class="service-form-container">
  <!-- è¡¨å•æ ‡é¢˜ -->
  <view wx:if="{{formSchema}}" class="form-header">
    <text class="form-title">{{formSchema.title}}</text>
  </view>

  <!-- åŠ¨æ€è¡¨å•å†…å®¹ -->
  <view wx:if="{{formSchema}}" class="form-content">
    <view wx:for="{{formSchema.fields}}" wx:key="key" class="form-field">
      
      <!-- æ–‡æœ¬è¾“å…¥æ¡† -->
      <view wx:if="{{item.type === 'text'}}" class="field-group">
        <view class="field-label">
          <text>{{item.label}}</text>
          <text wx:if="{{item.required}}" class="required">*</text>
        </view>
        <input
          class="field-input {{formErrors[item.key] ? 'error' : ''}}"
          placeholder="{{item.placeholder}}"
          value="{{formData[item.key]}}"
          maxlength="{{item.maxLength || -1}}"
          data-field="{{item.key}}"
          bindinput="onInputChange"
        />
        <view wx:if="{{formErrors[item.key]}}" class="error-message">
          {{formErrors[item.key]}}
        </view>
      </view>

      <!-- å¤šè¡Œæ–‡æœ¬æ¡† -->
      <view wx:elif="{{item.type === 'textarea'}}" class="field-group">
        <view class="field-label">
          <text>{{item.label}}</text>
          <text wx:if="{{item.required}}" class="required">*</text>
        </view>
        <textarea
          class="field-textarea {{formErrors[item.key] ? 'error' : ''}}"
          placeholder="{{item.placeholder}}"
          value="{{formData[item.key]}}"
          maxlength="{{item.maxLength || -1}}"
          data-field="{{item.key}}"
          bindinput="onInputChange"
          auto-height
        />
        <view wx:if="{{formErrors[item.key]}}" class="error-message">
          {{formErrors[item.key]}}
        </view>
      </view>

      <!-- é€‰æ‹©å™¨ -->
      <view wx:elif="{{item.type === 'picker'}}" class="field-group">
        <view class="field-label">
          <text>{{item.label}}</text>
          <text wx:if="{{item.required}}" class="required">*</text>
        </view>
        <picker
          class="field-picker {{formErrors[item.key] ? 'error' : ''}}"
          range="{{item.options}}"
          data-field="{{item.key}}"
          data-options="{{item.options}}"
          bindchange="onPickerChange"
        >
          <view class="picker-content">
            <text class="{{formData[item.key] ? 'selected' : 'placeholder'}}">
              {{formData[item.key] || 'è¯·é€‰æ‹©' + item.label}}
            </text>
            <text class="picker-arrow">â€º</text>
          </view>
        </picker>
        <view wx:if="{{formErrors[item.key]}}" class="error-message">
          {{formErrors[item.key]}}
        </view>
      </view>

      <!-- æ–‡ä»¶ä¸Šä¼  -->
      <view wx:elif="{{item.type === 'file'}}" class="field-group">
        <view class="field-label">
          <text>{{item.label}}</text>
          <text wx:if="{{item.required}}" class="required">*</text>
        </view>
        
        <!-- ä¸Šä¼ æŒ‰é’® -->
        <view class="file-upload-section">
          <button
            class="upload-btn {{formErrors[item.key] ? 'error' : ''}}"
            data-field="{{item.key}}"
            bindtap="onFileUpload"
          >
            <text class="upload-icon">ğŸ“</text>
            <text>é€‰æ‹©æ–‡ä»¶</text>
          </button>
          
          <!-- æ–‡ä»¶æç¤º -->
          <view class="upload-tips">
            <text>æ”¯æŒå›¾ç‰‡ã€PDFã€Wordæ–‡æ¡£ï¼Œæœ€å¤§50MB</text>
          </view>
        </view>

        <!-- å·²ä¸Šä¼ çš„æ–‡ä»¶åˆ—è¡¨ -->
        <view wx:if="{{uploadedFiles[item.key] && uploadedFiles[item.key].length > 0}}" class="uploaded-files">
          <view wx:for="{{uploadedFiles[item.key]}}" wx:key="url" wx:for-item="file" wx:for-index="fileIndex" class="file-item">
            <view class="file-info">
              <text class="file-icon">ğŸ“„</text>
              <text class="file-name">{{file.name}}</text>
              <text class="file-size">{{file.size > 1024 * 1024 ? (file.size / 1024 / 1024).toFixed(1) + 'MB' : (file.size / 1024).toFixed(1) + 'KB'}}</text>
            </view>
            <button
              class="remove-btn"
              data-field="{{item.key}}"
              data-index="{{fileIndex}}"
              bindtap="onRemoveFile"
            >
              Ã—
            </button>
          </view>
        </view>

        <view wx:if="{{formErrors[item.key]}}" class="error-message">
          {{formErrors[item.key]}}
        </view>
      </view>

      <!-- æ•°å­—è¾“å…¥ -->
      <view wx:elif="{{item.type === 'number'}}" class="field-group">
        <view class="field-label">
          <text>{{item.label}}</text>
          <text wx:if="{{item.required}}" class="required">*</text>
        </view>
        <input
          class="field-input {{formErrors[item.key] ? 'error' : ''}}"
          placeholder="{{item.placeholder}}"
          value="{{formData[item.key]}}"
          type="number"
          data-field="{{item.key}}"
          bindinput="onInputChange"
        />
        <view wx:if="{{formErrors[item.key]}}" class="error-message">
          {{formErrors[item.key]}}
        </view>
      </view>

    </view>
  </view>

  <!-- æäº¤æŒ‰é’® -->
  <view wx:if="{{formSchema}}" class="form-actions">
    <button
      class="submit-btn {{isValid ? 'enabled' : 'disabled'}}"
      disabled="{{!isValid || isSubmitting}}"
      loading="{{isSubmitting}}"
      bindtap="onSubmit"
    >
      {{isSubmitting ? 'æäº¤ä¸­...' : 'æäº¤'}}
    </button>
  </view>

  <!-- æ— è¡¨å•æç¤º -->
  <view wx:else class="no-form-tip">
    <text>è¯·é€‰æ‹©æœåŠ¡æˆ–é…ç½®è¡¨å•</text>
  </view>
</view>