<!--è®¢å•æ”¯ä»˜ç»„ä»¶æ¨¡æ¿-->
<view class="order-payment" wx:if="{{visible}}">
  
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-mask" wx:if="{{isLoading}}">
    <view class="loading-content">
      <view class="loading-spinner"></view>
      <view class="loading-text">
        {{isCreatingOrder ? 'æ­£åœ¨å‡†å¤‡è®¢å•...' : (isProcessingPayment ? 'å¤„ç†æ”¯ä»˜ä¸­...' : 'åŠ è½½ä¸­...')}}
      </view>
    </view>
  </view>

  <!-- è®¢å•ä¿¡æ¯ -->
  <view class="order-info" wx:if="{{orderInfo && !isLoading}}">
    <view class="info-header">
      <text class="header-title">è®¢å•è¯¦æƒ…</text>
      <view class="payment-status {{paymentStatus}}">
        {{getPaymentStatusText(paymentStatus)}}
      </view>
    </view>

    <!-- æœåŠ¡ä¿¡æ¯ -->
    <view class="service-info">
      <view class="service-name">{{orderInfo.serviceName}}</view>
      <view class="service-description" wx:if="{{orderInfo.serviceDescription}}">
        {{orderInfo.serviceDescription}}
      </view>
    </view>

    <!-- è®¢å•å· -->
    <view class="order-number" wx:if="{{orderInfo.orderNumber}}">
      <text class="label">è®¢å•å·ï¼š</text>
      <text class="value">{{orderInfo.orderNumber}}</text>
    </view>

    <!-- é‡‘é¢ä¿¡æ¯ -->
    <view class="amount-info">
      <view class="amount-row">
        <text class="amount-label">æœåŠ¡è´¹ç”¨</text>
        <text class="amount-value">Â¥{{formatAmount(orderInfo.amount)}}</text>
      </view>
      <view class="total-amount">
        <text class="total-label">å®ä»˜é‡‘é¢</text>
        <text class="total-value">Â¥{{formatAmount(orderInfo.amount)}}</text>
      </view>
    </view>

    <!-- äº¤æ˜“ä¿¡æ¯ -->
    <view class="transaction-info" wx:if="{{orderInfo.transactionId}}">
      <view class="transaction-row">
        <text class="label">äº¤æ˜“å·ï¼š</text>
        <text class="value">{{orderInfo.transactionId}}</text>
      </view>
      <view class="transaction-row" wx:if="{{orderInfo.paidAt}}">
        <text class="label">æ”¯ä»˜æ—¶é—´ï¼š</text>
        <text class="value">{{orderInfo.paidAt}}</text>
      </view>
    </view>
  </view>

  <!-- é”™è¯¯ä¿¡æ¯ -->
  <view class="error-message" wx:if="{{errorMessage && !isLoading}}">
    <view class="error-icon">âš ï¸</view>
    <view class="error-text">{{errorMessage}}</view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="payment-actions" wx:if="{{orderInfo && !isLoading}}">
    
    <!-- æ”¯ä»˜æˆåŠŸçŠ¶æ€ -->
    <view class="success-actions" wx:if="{{paymentStatus === 'success'}}">
      <view class="success-icon">âœ…</view>
      <view class="success-text">æ”¯ä»˜æˆåŠŸï¼æ‚¨çš„è®¢å•æ­£åœ¨å¤„ç†ä¸­</view>
      <button class="action-btn primary" bindtap="onViewOrder">æŸ¥çœ‹è®¢å•</button>
    </view>

    <!-- å¾…æ”¯ä»˜çŠ¶æ€ -->
    <view class="pending-actions" wx:elif="{{paymentStatus === 'pending'}}">
      <button 
        class="action-btn primary" 
        bindtap="createOrder"
        disabled="{{isProcessingPayment}}"
      >
        {{isProcessingPayment ? 'å¤„ç†ä¸­...' : 'ç«‹å³æ”¯ä»˜'}}
      </button>
      <button class="action-btn secondary" bindtap="onCancelPayment">å–æ¶ˆè®¢å•</button>
    </view>

    <!-- æ”¯ä»˜ä¸­çŠ¶æ€ -->
    <view class="paying-actions" wx:elif="{{paymentStatus === 'paying'}}">
      <view class="paying-icon">ğŸ’³</view>
      <view class="paying-text">æ­£åœ¨å¤„ç†æ”¯ä»˜ï¼Œè¯·ç¨å€™...</view>
      <view class="paying-progress">
        <view class="progress-bar">
          <view class="progress-fill"></view>
        </view>
        <view class="progress-text">ç¬¬{{paymentCheckCount}}æ¬¡æ£€æŸ¥æ”¯ä»˜çŠ¶æ€</view>
      </view>
    </view>

    <!-- æ”¯ä»˜å¤±è´¥çŠ¶æ€ -->
    <view class="failed-actions" wx:elif="{{paymentStatus === 'failed'}}">
      <button 
        class="action-btn primary" 
        bindtap="onRetryPayment"
        disabled="{{isProcessingPayment}}"
      >
        é‡æ–°æ”¯ä»˜
      </button>
      <button class="action-btn secondary" bindtap="onCancelPayment">å–æ¶ˆè®¢å•</button>
    </view>

    <!-- æ”¯ä»˜å–æ¶ˆçŠ¶æ€ -->
    <view class="cancelled-actions" wx:elif="{{paymentStatus === 'cancelled'}}">
      <view class="cancelled-icon">ğŸš«</view>
      <view class="cancelled-text">æ”¯ä»˜å·²å–æ¶ˆ</view>
      <button 
        class="action-btn primary" 
        bindtap="onRetryPayment"
        disabled="{{isProcessingPayment}}"
      >
        é‡æ–°æ”¯ä»˜
      </button>
      <button class="action-btn secondary" bindtap="onCancelPayment">å…³é—­</button>
    </view>
  </view>

  <!-- æ”¯ä»˜è¯´æ˜ -->
  <view class="payment-notice" wx:if="{{orderInfo && !isLoading}}">
    <view class="notice-title">æ”¯ä»˜è¯´æ˜</view>
    <view class="notice-content">
      <view class="notice-item">â€¢ æ”¯ä»˜æˆåŠŸåï¼Œæˆ‘ä»¬å°†ç«‹å³å¼€å§‹å¤„ç†æ‚¨çš„æœåŠ¡è¯·æ±‚</view>
      <view class="notice-item">â€¢ å¤„ç†å®Œæˆåä¼šé€šè¿‡å¾®ä¿¡é€šçŸ¥æ‚¨ç»“æœ</view>
      <view class="notice-item">â€¢ å¦‚æœ‰ç–‘é—®ï¼Œè¯·è”ç³»å®¢æœ</view>
    </view>
  </view>
</view>