<!--pages/orders/orders.wxml-->
<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">æˆ‘çš„è®¢å•</text>
    <text class="page-subtitle">ç®¡ç†æ‚¨çš„åŒ»ç–—æœåŠ¡è®¢å•</text>
  </view>

  <!-- è®¢å•çŠ¶æ€ç­›é€‰ -->
  <view class="filter-tabs">
    <scroll-view scroll-x="true" class="filter-scroll">
      <view class="filter-list">
        <view 
          wx:for="{{filterOptions}}" 
          wx:key="key" 
          class="filter-item {{currentFilter === item.key ? 'active' : ''}}" 
          bindtap="onFilterChange" 
          data-filter="{{item.key}}"
        >
          <text class="filter-text">{{item.label}}</text>
          <text wx:if="{{item.count > 0}}" class="filter-count">{{item.count}}</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½è®¢å•ä¸­...</text>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view wx:elif="{{error}}" class="error-container">
    <view class="error-icon">âš ï¸</view>
    <text class="error-text">{{error}}</text>
    <button class="retry-button" bindtap="onRetry">é‡è¯•</button>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:elif="{{filteredOrders.length === 0 && !loading}}" class="empty-container">
    <view class="empty-icon">ğŸ“‹</view>
    <text class="empty-text">æš‚æ— è®¢å•</text>
    <text class="empty-subtitle">æ‚¨è¿˜æ²¡æœ‰ä»»ä½•è®¢å•ï¼Œå¿«å»é€‰æ‹©æœåŠ¡å§</text>
    <button class="go-service-button" bindtap="goToServices">é€‰æ‹©æœåŠ¡</button>
  </view>

  <!-- è®¢å•åˆ—è¡¨ -->
  <view wx:else class="orders-list">
    <view 
      wx:for="{{filteredOrders}}" 
      wx:key="id" 
      class="order-item"
    >
      <!-- è®¢å•å¤´éƒ¨ä¿¡æ¯ -->
      <view class="order-header" bindtap="onViewOrder" data-order-id="{{item.id}}">
        <view class="order-info">
          <view class="order-title">{{item.serviceName}}</view>
          <view class="order-time">ä¸‹å•æ—¶é—´ï¼š{{item.createdAt}}</view>
          <view class="order-id">è®¢å•å·ï¼š{{item.id}}</view>
        </view>
        <view class="order-status">
          <view class="status-badge status-{{item.status}}">{{item.statusText}}</view>
          <view class="order-amount">ï¿¥{{item.amount}}</view>
        </view>
      </view>

      <!-- è®¢å•è¯¦ç»†ä¿¡æ¯ -->
      <view class="order-details">
        <!-- æœåŠ¡ä¿¡æ¯æ¦‚è¦ -->
        <view class="service-summary">
          <view wx:if="{{item.serviceData.age}}" class="detail-item">
            <text class="detail-label">å¹´é¾„ï¼š</text>
            <text class="detail-value">{{item.serviceData.age}}å²</text>
          </view>
          <view wx:if="{{item.serviceData.gender}}" class="detail-item">
            <text class="detail-label">æ€§åˆ«ï¼š</text>
            <text class="detail-value">{{item.serviceData.gender}}</text>
          </view>
          <view wx:if="{{item.serviceData.condition}}" class="detail-item">
            <text class="detail-label">æƒ…å†µï¼š</text>
            <text class="detail-value">{{item.serviceData.condition}}</text>
          </view>
          <view wx:if="{{item.serviceData.disease}}" class="detail-item">
            <text class="detail-label">ç–¾ç—…ï¼š</text>
            <text class="detail-value">{{item.serviceData.disease}}</text>
          </view>
          <view wx:if="{{item.serviceData.document}}" class="detail-item">
            <text class="detail-label">æ–‡æ¡£ï¼š</text>
            <text class="detail-value">{{item.serviceData.document}}</text>
          </view>
        </view>

        <!-- æ—¶é—´è½´ -->
        <view class="order-timeline">
          <view class="timeline-item completed">
            <view class="timeline-dot"></view>
            <view class="timeline-content">
              <text class="timeline-title">è®¢å•åˆ›å»º</text>
              <text class="timeline-time">{{item.createdAt}}</text>
            </view>
          </view>
          
          <view wx:if="{{item.paidAt}}" class="timeline-item completed">
            <view class="timeline-dot"></view>
            <view class="timeline-content">
              <text class="timeline-title">æ”¯ä»˜å®Œæˆ</text>
              <text class="timeline-time">{{item.paidAt}}</text>
            </view>
          </view>
          
          <view wx:if="{{item.status === 'processing'}}" class="timeline-item active">
            <view class="timeline-dot"></view>
            <view class="timeline-content">
              <text class="timeline-title">ä»»åŠ¡æ‰§è¡Œä¸­</text>
              <text class="timeline-time">é¢„è®¡3-5ä¸ªå·¥ä½œæ—¥å®Œæˆ</text>
            </view>
          </view>
          
          <view wx:if="{{item.completedAt}}" class="timeline-item completed">
            <view class="timeline-dot"></view>
            <view class="timeline-content">
              <text class="timeline-title">ä»»åŠ¡å®Œæˆ</text>
              <text class="timeline-time">{{item.completedAt}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- è®¢å•æ“ä½œæŒ‰é’® -->
      <view class="order-actions">
        <!-- å¾…ä»˜æ¬¾çŠ¶æ€æŒ‰é’® -->
        <view wx:if="{{item.status === 'pending'}}" class="action-buttons">
          <button class="action-btn cancel-btn" bindtap="onCancelOrder" data-order="{{item}}">å–æ¶ˆè®¢å•</button>
          <button class="action-btn pay-btn" bindtap="onContinuePayment" data-order="{{item}}">ç»§ç»­æ”¯ä»˜</button>
        </view>

        <!-- å·²ä»˜æ¬¾çŠ¶æ€æŒ‰é’® -->
        <view wx:elif="{{item.status === 'paid'}}" class="action-buttons">
          <button class="action-btn detail-btn" bindtap="onViewOrder" data-order-id="{{item.id}}">æŸ¥çœ‹è¯¦æƒ…</button>
          <button class="action-btn reorder-btn" bindtap="onReorder" data-order="{{item}}">é‡æ–°è´­ä¹°</button>
        </view>

        <!-- å¤„ç†ä¸­çŠ¶æ€æŒ‰é’® -->
        <view wx:elif="{{item.status === 'processing'}}" class="action-buttons">
          <button class="action-btn detail-btn" bindtap="onViewOrder" data-order-id="{{item.id}}">æŸ¥çœ‹è¯¦æƒ…</button>
          <button class="action-btn progress-btn" bindtap="onViewProgress" data-order-id="{{item.id}}">æŸ¥çœ‹è¿›åº¦</button>
        </view>

        <!-- å·²å®ŒæˆçŠ¶æ€æŒ‰é’® -->
        <view wx:elif="{{item.status === 'completed'}}" class="action-buttons">
          <button class="action-btn detail-btn" bindtap="onViewOrder" data-order-id="{{item.id}}">æŸ¥çœ‹è¯¦æƒ…</button>
          <button wx:if="{{item.hasResult}}" class="action-btn result-btn" bindtap="onViewResult" data-order-id="{{item.id}}">æŸ¥çœ‹ç»“æœ</button>
          <button class="action-btn reorder-btn" bindtap="onReorder" data-order="{{item}}">é‡æ–°è´­ä¹°</button>
        </view>

        <!-- å·²å–æ¶ˆçŠ¶æ€æŒ‰é’® -->
        <view wx:elif="{{item.status === 'cancelled'}}" class="action-buttons">
          <button class="action-btn detail-btn" bindtap="onViewOrder" data-order-id="{{item.id}}">æŸ¥çœ‹è¯¦æƒ…</button>
          <button class="action-btn reorder-btn" bindtap="onReorder" data-order="{{item}}">é‡æ–°è´­ä¹°</button>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½æ›´å¤šæŒ‡ç¤ºå™¨ -->
  <view wx:if="{{isLoadingMore}}" class="load-more-indicator">
    <view class="loading-spinner small"></view>
    <text class="loading-text">åŠ è½½æ›´å¤š...</text>
  </view>

  <!-- æ²¡æœ‰æ›´å¤šæ•°æ®æç¤º -->
  <view wx:if="{{!hasMoreData && filteredOrders.length > 0}}" class="no-more-data">
    <text>å·²æ˜¾ç¤ºå…¨éƒ¨è®¢å•</text>
  </view>

  <!-- åº•éƒ¨æç¤ºä¿¡æ¯ -->
  <view class="footer-info">
    <view class="info-item">
      <text class="info-icon">ğŸ’¡</text>
      <text class="info-text">ç‚¹å‡»è®¢å•å¯æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</text>
    </view>
    <view class="info-item">
      <text class="info-icon">ğŸ”„</text>
      <text class="info-text">æ”¯æŒé‡æ–°è´­ä¹°ç›¸åŒæœåŠ¡</text>
    </view>
    <view class="info-item">
      <text class="info-icon">ğŸ“</text>
      <text class="info-text">å¦‚æœ‰ç–‘é—®ï¼Œè¯·è”ç³»å®¢æœ</text>
    </view>
  </view>
</view>