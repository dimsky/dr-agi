<!--result.wxml-->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ç»“æœä¸­...</text>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view wx:elif="{{error}}" class="error-container">
    <view class="error-icon">âŒ</view>
    <text class="error-text">{{error}}</text>
    <button class="retry-btn" bindtap="onRetry">é‡è¯•</button>
  </view>

  <!-- ç»“æœå†…å®¹ -->
  <view wx:else class="result-content">
    <!-- ç»“æœå¤´éƒ¨ä¿¡æ¯ -->
    <view class="result-header">
      <view class="header-title">
        <text class="service-name">{{resultInfo.serviceName}}</text>
        <text class="completion-badge">å·²å®Œæˆ</text>
      </view>
      <view class="header-info">
        <text class="task-id">ä»»åŠ¡ID: {{resultInfo.taskId}}</text>
        <text class="completion-time">å®Œæˆæ—¶é—´: {{resultInfo.completedTime}}</text>
        <text class="execution-time">è€—æ—¶: {{resultInfo.executionTime}}</text>
      </view>
    </view>

    <!-- ç»“æœæ‘˜è¦ -->
    <view wx:if="{{resultContent.summary}}" class="result-summary">
      <view class="summary-header">
        <text class="summary-title">ğŸ“‹ ç»“æœæ‘˜è¦</text>
      </view>
      <text class="summary-content">{{resultContent.summary}}</text>
    </view>

    <!-- æ–‡æœ¬ç»“æœ -->
    <view wx:if="{{resultContent.textContent && resultType !== 'mixed'}}" class="text-result">
      <view class="result-section-header">
        <text class="section-title">ğŸ“„ åˆ†ææŠ¥å‘Š</text>
        <button class="copy-btn" bindtap="onCopyText">å¤åˆ¶</button>
      </view>
      <view class="text-content">
        <text class="text-body">{{resultContent.textContent}}</text>
      </view>
    </view>

    <!-- æ··åˆç»“æœå±•ç¤º -->
    <view wx:if="{{resultType === 'mixed'}}" class="mixed-result">
      <!-- æ–‡æœ¬éƒ¨åˆ† -->
      <view wx:if="{{resultContent.textContent}}" class="result-section">
        <view class="result-section-header">
          <text class="section-title">ğŸ“„ æ–‡å­—æŠ¥å‘Š</text>
          <button class="copy-btn" bindtap="onCopyText">å¤åˆ¶</button>
        </view>
        <view class="text-content">
          <text class="text-body">{{resultContent.textContent}}</text>
        </view>
      </view>

      <!-- å›¾ç‰‡éƒ¨åˆ† -->
      <view wx:if="{{resultContent.images.length > 0}}" class="result-section">
        <view class="result-section-header">
          <text class="section-title">ğŸ–¼ï¸ å›¾ç‰‡ç»“æœ</text>
        </view>
        <view class="images-grid">
          <view wx:for="{{resultContent.images}}" wx:key="index" class="image-item">
            <image 
              class="result-image" 
              src="{{item.url}}" 
              mode="aspectFill"
              data-current="{{item.url}}"
              bindtap="onPreviewImage"
            ></image>
            <view wx:if="{{item.title}}" class="image-title">{{item.title}}</view>
            <view wx:if="{{item.description}}" class="image-desc">{{item.description}}</view>
          </view>
        </view>
      </view>

      <!-- æ–‡ä»¶éƒ¨åˆ† -->
      <view wx:if="{{resultContent.files.length > 0}}" class="result-section">
        <view class="result-section-header">
          <text class="section-title">ğŸ“ æ–‡ä»¶é™„ä»¶</text>
        </view>
        <view class="files-list">
          <view wx:for="{{resultContent.files}}" wx:key="index" class="file-item">
            <view class="file-info">
              <text class="file-name">{{item.name}}</text>
              <text class="file-size">{{item.size || 'æœªçŸ¥å¤§å°'}}</text>
            </view>
            <button 
              class="download-btn" 
              data-url="{{item.url}}" 
              data-name="{{item.name}}"
              bindtap="onDownloadFile"
            >
              ä¸‹è½½
            </button>
          </view>
        </view>
      </view>
    </view>

    <!-- çº¯å›¾ç‰‡ç»“æœ -->
    <view wx:if="{{resultType === 'image' && resultContent.images.length > 0}}" class="image-result">
      <view class="result-section-header">
        <text class="section-title">ğŸ–¼ï¸ å›¾ç‰‡åˆ†æç»“æœ</text>
      </view>
      <view class="images-grid">
        <view wx:for="{{resultContent.images}}" wx:key="index" class="image-item">
          <image 
            class="result-image large" 
            src="{{item.url}}" 
            mode="aspectFill"
            data-current="{{item.url}}"
            bindtap="onPreviewImage"
          ></image>
          <view wx:if="{{item.title}}" class="image-title">{{item.title}}</view>
          <view wx:if="{{item.description}}" class="image-desc">{{item.description}}</view>
        </view>
      </view>
    </view>

    <!-- PDFç»“æœ -->
    <view wx:if="{{resultType === 'pdf' && resultContent.pdfUrl}}" class="pdf-result">
      <view class="result-section-header">
        <text class="section-title">ğŸ“‹ PDFæŠ¥å‘Š</text>
      </view>
      <view class="pdf-preview">
        <view class="pdf-icon">ğŸ“„</view>
        <text class="pdf-title">åˆ†ææŠ¥å‘Š.pdf</text>
        <button 
          class="download-btn primary" 
          data-url="{{resultContent.pdfUrl}}" 
          data-name="åˆ†ææŠ¥å‘Š.pdf"
          bindtap="onDownloadFile"
        >
          æŸ¥çœ‹PDFæŠ¥å‘Š
        </button>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’®åŒºåŸŸ -->
    <view class="action-section">
      <view class="action-buttons">
        <button class="action-btn share-btn" bindtap="onShareResult">
          <text class="btn-icon">ğŸ”—</text>
          <text class="btn-text">åˆ†äº«ç»“æœ</text>
        </button>
        
        <button class="action-btn rating-btn" bindtap="onShowRating">
          <text class="btn-icon">â­</text>
          <text class="btn-text">{{hasRated ? 'å·²è¯„ä»·' : 'æ»¡æ„åº¦è¯„ä»·'}}</text>
        </button>
      </view>
      
      <button class="back-btn" bindtap="onGoBack">è¿”å›</button>
    </view>
  </view>

  <!-- è¯„ä»·å¼¹çª— -->
  <view wx:if="{{ratingVisible}}" class="rating-modal">
    <view class="modal-overlay" bindtap="onHideRating"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">æœåŠ¡æ»¡æ„åº¦è¯„ä»·</text>
        <view class="close-btn" bindtap="onHideRating">âœ•</view>
      </view>
      
      <view class="rating-section">
        <text class="rating-label">è¯·ä¸ºæœ¬æ¬¡æœåŠ¡æ‰“åˆ†ï¼š</text>
        <view class="rating-stars">
          <view 
            wx:for="{{[1,2,3,4,5]}}" 
            wx:key="*this"
            class="star {{currentRating >= item ? 'active' : ''}}"
            data-rating="{{item}}"
            bindtap="onSelectRating"
          >
            â­
          </view>
        </view>
        <text class="rating-desc">
          {{currentRating === 5 ? 'éå¸¸æ»¡æ„' : 
            currentRating === 4 ? 'æ»¡æ„' : 
            currentRating === 3 ? 'ä¸€èˆ¬' : 
            currentRating === 2 ? 'ä¸æ»¡æ„' : 'éå¸¸ä¸æ»¡æ„'}}
        </text>
      </view>
      
      <view class="comment-section">
        <text class="comment-label">æ„è§å»ºè®®ï¼ˆå¯é€‰ï¼‰ï¼š</text>
        <textarea 
          class="comment-input" 
          placeholder="è¯·åˆ†äº«æ‚¨çš„ä½¿ç”¨ä½“éªŒå’Œå»ºè®®..."
          value="{{ratingComment}}"
          bindinput="onRatingInput"
          maxlength="500"
        ></textarea>
      </view>
      
      <view class="modal-actions">
        <button class="cancel-btn" bindtap="onHideRating">å–æ¶ˆ</button>
        <button class="submit-btn" bindtap="onSubmitRating">æäº¤è¯„ä»·</button>
      </view>
    </view>
  </view>
</view>